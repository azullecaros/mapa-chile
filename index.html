<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa Regiones Chile</title>
    <link href="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css" rel="stylesheet">
    <style>
        body { margin: 0; padding: 0; }
        #map { position: absolute; top: 0; bottom: 0; width: 100%; }

        .mapboxgl-popup {
            max-width: 300px;
            font-family: 'Open Sans', sans-serif;
        }

        .mapboxgl-popup-content {
            white-space: normal;
            word-wrap: break-word;
            padding: 15px;
            box-sizing: border-box;
            border-radius: 12px;
        }

        .popup-card {
            display: inline-block;
            padding: 10px;
            border-radius: 12px;
            color: #201245;
            font-weight: bold;
            margin-right: 8px;
            text-align: center;
            min-width: 90px;
        }

        .manuales { background-color: #E2D2F6; }
        .maleta { background-color: #A5C4E3; }
        .mobilelab { background-color: #A9DADC; }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js"></script>
<script>
    mapboxgl.accessToken = 'TU_ACCESS_TOKEN_DE_MAPBOX';

    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v11',
        center: [-70.67, -33.45],
        zoom: 4
    });

    map.on('load', () => {
        // Fuente GeoJSON local
        map.addSource('centros', {
            type: 'geojson',
            data: 'datos.geojson' // tu archivo GeoJSON
        });

        // Capa de círculos
        map.addLayer({
            id: 'circulos',
            type: 'circle',
            source: 'centros',
            paint: {
                'circle-color': '#E2D2F6',
                'circle-radius': [
                    'interpolate', ['linear'], 
                    ['+', ['get', 'manuales'], ['get', 'maleta'], ['get', 'mobilelab']],
                    0, 10,
                    500, 40
                ],
                'circle-stroke-width': 1,
                'circle-stroke-color': '#fff'
            }
        });

        // Capa de texto
        map.addLayer({
            id: 'labels',
            type: 'symbol',
            source: 'centros',
            layout: {
                'text-field': [
                    'to-string', 
                    ['+', ['get', 'manuales'], ['get', 'maleta'], ['get', 'mobilelab']]
                ],
                'text-size': 14,
                'text-font': ['Open Sans Bold'],
                'text-allow-overlap': true,
                'text-ignore-placement': true
            },
            paint: {
                'text-color': '#201245'
            }
        });

        // Popup al hacer click
        map.on('click', 'circulos', (e) => {
            const props = e.features[0].properties;
            const region = props.region;
            const manuales = props.manuales;
            const maleta = props.maleta;
            const mobilelab = props.mobilelab;

            const popupContent = `
                <h3 style="margin:0 0 10px 0; color:#201245;">${region}</h3>
                <div class="popup-card manuales">${manuales}<br><small>usuarios de Manuales</small></div>
                <div class="popup-card maleta">${maleta}<br><small>usuarios de Maleta</small></div>
                <div class="popup-card mobilelab">${mobilelab}<br><small>usuarios de MobileLab</small></div>
            `;

            new mapboxgl.Popup()
                .setLngLat(e.lngLat)
                .setHTML(popupContent)
                .addTo(map);
        });

        // Cursor tipo mano sobre círculos
        map.on('mouseenter', 'circulos', () => {
            map.getCanvas().style.cursor = 'pointer';
        });
        map.on('mouseleave', 'circulos', () => {
            map.getCanvas().style.cursor = '';
        });
    });
</script>

</body>
</html>




